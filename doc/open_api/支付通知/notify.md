
## 支付通知

> 说明

通知结果参数列表
通知URL是统一下单接口中提交的参数 notifyUrl，支付完成后，平台会把相关支付和用户信息发送到该 URL，商户需要接收处理信息。

对后台通知交互时，如果平台收到商户的应答code非SUCCESS时超过5秒后返回时，平台认为通知失败，平台会通过一定的策略（如3小时共10次）间接性重新发起通知，尽可能提高通知的成功率，但不保证通知最终能成功。

由于存在重新发送后台通知的情况， 因此同样的通知可能会多次发送给商户系统。 商户系统必须能够正确处理重复的通知。

推荐的做法是， 当收到通知进行处理时， 首先检查对应业务数据的状态， 判断该通知是否已经处理过， 如果没有处理过再进行处理， 如果处理过直接返回结果成功。 在对业务数据进行状态检查和处理之前， 要采用数据锁进行并发控制， 以避免函数重入造成的数据混乱。

!> 特别注意：商户后台接收到通知参数后，要对接收到通知参数里的商户订单号orderNo、订单金额orderAmount和成功金额succAmount自身业务系统的订单和金额做校验，校验一致后才更新数据库订单状态

通知参数：

| 参数          | 说明     | 类型     | 长度   | 必须   | 备注                                       |
| ----------- | ------ | ------ | ---- | ---- | ---------------------------------------- |
| mid         | 商户号    | string | 15   | Y    | 商户号                                      |
| status      | 订单状态   | string | 2    | Y    | 1:交易成功,2:交易失败                            |
| orderNo     | 商户订单号  | string | 32   | Y    | 商户订单号                                    |
| flowNo      | 支付流水号  | string | 32   | Y    | 平台流水号                                    |
| tradeNo     | 第三方流水号 | string | 64   | N    | 支付宝或微信返回的流水号                             |
| orderAmount | 订单金额   | number | 18,2 | Y    | -                                        |
| succAmount  | 成功金额   | number | 18,2 | N    | 支付成功金额(支付状态在成功时返回)                       |
| type        | 支付方式   | string | 10   | Y    | wechat:微信<br/>alipay:支付宝<br/>QQwallet:QQ钱包<br/>netpay:网银支付<br/>quickpay:快捷支付<br/>jd:京东支付 |
| orderTime   | 订单创建时间 | string | 14   | Y    | yyyyMMddHHmmss                           |
| payTime     | 支付完成时间 | string | 14   | N    | yyyyMMddHHmmss                           |
| noise       | 随机字符串  | string | 32   | Y    | 随机字符串，不长于32位                             |
| sign        | 签名     | string | 128  | Y    | 见 [数字签名](/qianming)                      |




通知示例：

```
mid=100000510983456&noise=8X9DERT146J&orderNo=M201611101010100002&flowNo=20161101010100198763&tradeNo=1217752501201407033233368018&orderAmount=5230.00&succAmount=5230.00&type=wechat&status=1&orderTime=20161110101010&payTime=20161110101323&noise=24rewrfsdffjrewr&sign=567A9D86BD90C09567A9D86BD90C098C
```




响应参数：
​    
| 参数   | 说明     | 类型     | 长度   | 必须   | 备注                                       |
| ---- | ------ | ------ | ---- | ---- | ---------------------------------------- |
| code | 商户返回码  | string | 32   | Y    | 商户系统收到通知时返回。SUCCESS:成功接收并校验通过，其他:表示失败，会按照一定规则继续通知 |
| msg  | 商户返回消息 | string | 64   | N    | 当code为SUCCESS时，此处可为空;当code为其他值时，此处为错误原因  |

响应示例：

```json
{
	"code":"SUCCESS","msg":"ok"
}

```


## 返回状态码


| 返回码     | 描述   | 解决方案                |
| ------- | ---- | ------------------- |
| SUCCESS | 成功   |                     |
| 其他      | 异常   | [见错误码](/error_code) |




## 数字签名  
> 见数字签名 [数字签名](/qianming)


​	
​	
​	
​	


​	
